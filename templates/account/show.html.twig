{% extends 'base.html.twig' %}

{% block title %}Hello AccountController!{% endblock %}
{% block stylesheets %}
<style>
		.form-group > label.error {
			display: block !important;
			text-transform: none;
		}

		.form-group input.valid ~ label.error,
		.form-group input[type="text"] ~ label.error,
		.form-group input[type="email"] ~ label.error,
		.form-group input[type="number"] ~ label.error,
		.form-group select ~ label.error { display: none !important; }
	</style>
{% endblock %}

{% form_theme form '/_collection.html.twig' %}

{% block body %}
<link rel="stylesheet" type="text/css" id="u0" href="/js/components/tinymce/skins/ui/oxide/skin.min.css">
{% set cv = user.candidat.cv %}
{% set critere = user.candidat.critere %}
    <section id="content">
			<div class="content-wrap">
				<div class="container clearfix">

					<div class="row clearfix">

						<div class="col-md-9">

							<img src="{{user.candidat.picture}}" class="alignleft img-circle img-thumbnail my-0" alt="Avatar" style="max-width: 84px;">

							<div class="heading-block border-0">
								<h3>{{candidat.user.firstName}} {{candidat.user.lastName}} </h3>
								<span>{{candidat.user.numTel}}</span>
							</div>

							<div class="clear"></div>

							<div class="row clearfix">

								<div class="col-lg-12">

									<div class="tabs tabs-alt clearfix ui-tabs ui-corner-all ui-widget ui-widget-content" id="tabs-profile">

										<ul class="tab-nav clearfix ui-tabs-nav ui-corner-all ui-helper-reset ui-helper-clearfix ui-widget-header" role="tablist">
											<li role="tab" tabindex="0" class="ui-tabs-tab ui-corner-top ui-state-default ui-tab ui-tabs-active ui-state-active" aria-controls="tab-feeds" aria-labelledby="ui-id-1" aria-selected="true" aria-expanded="true"><a href="#tab-feeds" role="presentation" tabindex="-1" class="ui-tabs-anchor" id="ui-id-1"><i class="icon-rss2"></i> Information</a></li>
											<li role="tab" tabindex="-1" class="ui-tabs-tab ui-corner-top ui-state-default ui-tab" aria-controls="tab-posts" aria-labelledby="ui-id-2" aria-selected="false" aria-expanded="false"><a href="#tab-posts" role="presentation" tabindex="-1" class="ui-tabs-anchor" id="ui-id-2"><i class="icon-pencil2"></i> Cv </a></li>
											<li role="tab" tabindex="-1" class="ui-tabs-tab ui-corner-top ui-state-default ui-tab" aria-controls="tab-replies" aria-labelledby="ui-id-3" aria-selected="false" aria-expanded="false"><a href="#tab-replies" role="presentation" tabindex="-1" class="ui-tabs-anchor" id="ui-id-3"><i class="icon-reply"></i> Offres postuler</a></li>
											<li role="tab" tabindex="-1" class="ui-tabs-tab ui-corner-top ui-state-default ui-tab" aria-controls="tab-connections" aria-labelledby="ui-id-4" aria-selected="false" aria-expanded="false"><a href="#tab-connections" role="presentation" tabindex="-1" class="ui-tabs-anchor" id="ui-id-4"><i class="icon-users"></i> Connections</a></li>
										</ul>

										<div class="tab-container">

											<div class="tab-content clearfix ui-tabs-panel ui-corner-bottom ui-widget-content" id="tab-feeds" aria-labelledby="ui-id-1" role="tabpanel" aria-hidden="false" style="">
												<div class="col-md-12 py-1 postcontent" style="background-color: #F5F5F5;">
													<div>
														<div class="heading-block">
															<div class="row mt-5">
																<div class="col-5">
																	{# <img src="{{entreprise.picture}}" class="border border-f5 border-dark " alt="" srcset=""> #}
																</div>
																<div class="col-7">
																	<h3> {{user.civilite}} {{user.firstName}} {{user.lastName}} </h3>
																	<span class="before-heading color">{{user.address}} &amp; {{user.ville}}</span>
																</div>
															</div>
														</div>

														<div class="row col-mb-50">
															<div class="col-lg-12 mb-4">
																	<div class="row">
																		<span class="col-6 h4">Prénom :</span>
																		<div class="col-6 h5 dark-color" style="width: 60%;">
																			{{user.firstName}}
																		</div>
																	</div>
																	<div class="row">
																		<span class="col-6 h4">Nom :</span>
																		<div class="col-6 h5 dark-color" style="width: 60%;">
																			{{user.lastName}}
																		</div>
																	</div>
																	<div class="row">
																		<span class="col-6 h4">Téléphone :</span>
																		<div class="col-6 h5 dark-color" style="width: 60%;">
																			{{user.numTel}}
																		</div>
																	</div>
																	<div class="row">
																		<span class="col-6 h4">Email :</span>
																		<div class="col-6 h5 dark-color" style="width: 60%;">
																			{{user.email}}
																		</div>
																	</div>
																	<div class="row">
																		<span class="col-6 h4">Ville :</span>
																		<div class="col-6 h5 dark-color" style="width: 60%;">
																			{{user.ville}}
																		</div>
																	</div>
																	<div class="row">
																		<span class="col-6 h4">Pays de résidence:</span>
																		<div class="col-6 h5 dark-color" style="width: 60%;">
																			{{user.pays}}
																		</div>
																	</div>
																	<div class="row">
																		<span class="col-6 h4">Nationalité :</span>
																		<div class="col-6 h5 dark-color" style="width: 60%;">
																			{{user.nationalite}}
																		</div>
																	</div>

																	<div class="row">
																		<span class="col-6 h4">Adresse :</span>
																			<div class="float-center col-6 h5 dark-color" style="width: 80%;">
																					{{user.address}}
																			</div>
																	</div>
															</div>

															<div class="col-lg-12">
															<div class="content">
																	<blockquote>
																			 {{cv.competence | raw}}
																	</blockquote>

															</div>

																<a href="#" class="social-icon inline-block si-small si-light si-rounded si-facebook">
																	<i class="icon-facebook"></i>
																	<i class="icon-facebook"></i>
																</a>
																<a href="#" class="social-icon inline-block si-small si-light si-rounded si-twitter">
																	<i class="icon-twitter"></i>
																	<i class="icon-twitter"></i>
																</a>
																<a href="#" class="social-icon inline-block si-small si-light si-rounded si-gplus">
																	<i class="icon-gplus"></i>
																	<i class="icon-gplus"></i>
																</a>
															</div>
														</div>

													</div>
												</div>


											</div>
											<div class="tab-content clearfix ui-tabs-panel ui-corner-bottom ui-widget-content" id="tab-posts" aria-labelledby="ui-id-2" role="tabpanel" aria-hidden="true" style="display: none;">

											<div class="col-md-12 py-1 postcontent" style="background-color: #F5F5F5;">
													<div>
														<div class="heading-block">
															<div class="row mt-5">
																<div class="col-5">
																	{# <img src="{{entreprise.picture}}" class="border border-f5 border-dark " alt="" srcset=""> #}
																</div>
																<div class="col-7">
																	<h3>{{user.firstName}} {{user.lastName}} </h3>
																	<span class="before-heading color">{{user.address}} &amp; {{user.ville}}</span>
																</div>
															</div>
														</div>
															<div class="fancy-title title-bottom-border mb-2">
																		<h1>Competence et Formation</h1>
																	</div>
														<div class="row col-mb-50">
															<div class="col-lg-12 mb-4">
																	<div class="row">
																		<span class="col-6 h4">Niveau d'etudes :</span>
																		<div class="col-6  color" style="width: 60%;">
																			{{cv.niveauEtude}}
																		</div>
																	</div>
																	<div class="row">
																		<span class="col-6 h4 ">Formations :</span>
																		<div class="col-12  dark-color" style="width: 60%;">
																					<table class="table table-bordered shadow bg-light border border-f5 table-striped">
																						<thead>
																						<tr>
																							<th>Titre</th>
																							<th>Etablissement</th>
																							<th>Date Debut</th>
																							<th>Date Fin</th>
																						</tr>
																						</thead>
																						<tbody>
																						{% for formation in cv.formations %}
																						<tr>
																							<td>
																								{{formation.titre}}
																							</td>
																							<td>
																								{{formation.nomEcole}}
																							</td>
																							<td>
																							<code>{{formation.dateDebut |date('d/m/Y')}}</code>
																							</td>
																							<td>
																							<code>{{formation.dateFin  |date('d/m/Y')}}</code>
																							</td>
																						</tr>
																						{% endfor %}

																						</tbody>
																					</table>
																		</div>
																	</div>
																	<div class="row mt-3">
																		<span class="col-6 h4 ">Niveau Experience:</span>
																		<div class="col-6  color" style="width: 60%;">
																			{{cv.niveauExperience}}
																		</div>
																	</div>
																	<div class="row mt-3">
																		<span class="col-6 h4">Experience :</span>
																		<div class="col-12  dark-color" style="width: 60%;">
																					<table class="table table-bordered shadow bg-light border border-f5 table-striped">
																						<thead>
																						<tr>
																							<th>Poste</th>
																							<th>Entreprise</th>
																							<th>Date Debut</th>
																							<th>Date Fin</th>
																						</tr>
																						</thead>
																						<tbody>
																						{% for experience in cv.experiences %}
																						<tr>
																							<td>
																								{{experience.poste}}
																							</td>
																							<td>
																								{{experience.entreprise}}
																							</td>
																							<td>
																							<code>{{experience.dateDebut |date('d/m/Y')}}</code>
																							</td>
																							<td>
																							<code>{{experience.dateFin  |date('d/m/Y')}}</code>
																							</td>
																						</tr>
																						{% endfor %}

																						</tbody>
																					</table>
																		</div>
																	</div>
																	<div class="fancy-title title-bottom-border mt-3 mb-2">
																		<h1 >Critères de recherche</h1>
																	</div>
																	<div class="row mt-5">
																		<span class="col-6 h4 ">Secteur d'activités :</span>
																		<div class="col-6  color" style="width: 60%;">
																			{% for secteur in critere.secteurActivites %}
																						{{secteur}}
																			{% endfor %}
																		</div>
																	</div>
																	<div class="row mt-3">
																		<span class="col-6 h4 ">Langues:</span>
																		<div class="col-6  color" style="width: 60%;">
																			{% for langue in critere.langues %}
																						{{langue}}
																			{% endfor %}
																		</div>
																	</div>
																	<div class="row mt-3">
																		<span class="col-6 h4">Metier :</span>
																		<div class="col-6  color" style="width: 60%;">
																			{{critere.metier}}
																		</div>
																	</div>

																	<div class="row mt-3">
																		<span class="col-6 h4">Type de Contrat Souhaiter :</span>
																			<div class="float-center col-6  color" style="width: 80%;">
																			{% for contrat in critere.typeContrats %}
																					{{contrat}},
																			{% endfor %}
																			</div>
																	</div>
																	<div class="row mt-3">
																		<span class="col-6 h4">Salaire minimum exige :</span>
																			<div class="float-center col-6  color" style="width: 80%;">
																					{{critere.renumeration }}
																			</div>
																	</div>
																	<div class="row mt-3">
																		<span class="col-6 h4">Mobilités :</span>
																			<div class="float-center col-6  color" style="width: 80%;">
																					{% for mobilite in critere.mobilites %}
																							{{mobilite }},
																					{% endfor %}
																			</div>
																	</div>
															</div>

															<div class="col-lg-12">
															{# <div class="content">
																	<blockquote>
																			 {{cv.competence | raw}}
																	</blockquote>

															</div> #}

																<a href="#" class="social-icon inline-block si-small si-light si-rounded si-facebook">
																	<i class="icon-facebook"></i>
																	<i class="icon-facebook"></i>
																</a>
																<a href="#" class="social-icon inline-block si-small si-light si-rounded si-twitter">
																	<i class="icon-twitter"></i>
																	<i class="icon-twitter"></i>
																</a>
																<a href="#" class="social-icon inline-block si-small si-light si-rounded si-gplus">
																	<i class="icon-gplus"></i>
																	<i class="icon-gplus"></i>
																</a>
															</div>
														</div>

													</div>
												</div>

											</div>
											<div class="tab-content clearfix ui-tabs-panel ui-corner-bottom ui-widget-content" id="tab-replies" aria-labelledby="ui-id-3" role="tabpanel" aria-hidden="true" style="display: none;">


												<table class="table table-bordered table-striped">
												  <thead>
													<tr>
													  <th>Offres</th>
													  <th>Entreprise</th>
													  <th>Action</th>
													</tr>
												  </thead>
												  <tbody>
													{% for offre in user.candidat.offres %}
														<tr>
															<td>{{offre.poste}}</td>
															<td>
															{{offre.entreprise.nom}}
															</td>
															<td>
															{% set url = path('emploi_remove', {'id' : offre.id} ) %}
															<a class="btn btn-danger" href="{{ url }}" onclick="return confirm(`Êtes vous sur de vouloir retirer {{offre.poste}} ?`) ">retirer</a>
															</td>
														</tr>
													{% endfor %}

												  </tbody>
												</table>
												<div class="clear topmargin-sm"></div>

											</div>
											<div class="tab-content clearfix ui-tabs-panel ui-corner-bottom ui-widget-content" id="tab-connections" aria-labelledby="ui-id-4" role="tabpanel" aria-hidden="true" style="display: none;">



											</div>

										</div>

									</div>

								</div>

							</div>

						</div>

						<div class="w-100 line d-block d-md-none"></div>

						<div class="col-md-3">

							<div class="list-group">
								<a href="{{ path('my_account') }}" class="list-group-item list-group-item-action d-flex justify-content-between"><div>Profile</div><i class="icon-user"></i></a>
								<a href="{{ path('edit_cv') }}" class="list-group-item list-group-item-action d-flex justify-content-between"><div>Edition du Cv</div><i class="icon-laptop2"></i></a>
								<a href="{{ path('edit_critere') }}" class="list-group-item list-group-item-action d-flex justify-content-between"><div>Mes Critères de Recherche</div><i class="icon-envelope2"></i></a>
								<a href="#" class="list-group-item list-group-item-action d-flex justify-content-between"><div>Billing</div><i class="icon-credit-cards"></i></a>
								<a href="{{ path('edit_profil') }}" class="list-group-item list-group-item-action d-flex justify-content-between"><div>Settings</div><i class="icon-cog"></i></a>
								<a href="{{ path('account_logout') }}" class="list-group-item list-group-item-action d-flex justify-content-between"><div>Logout</div><i class="icon-line2-logout"></i></a>
							</div>

							<div class="fancy-title topmargin title-border">
								<h4>About Me</h4>
							</div>

							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsum laboriosam, dignissimos veniam obcaecati. Quasi eaque, odio assumenda porro explicabo laborum!</p>

							<div class="fancy-title topmargin title-border">
								<h4>Social Profiles</h4>
							</div>

							<a href="#" class="social-icon si-facebook si-small si-rounded si-light" title="Facebook">
								<i class="icon-facebook"></i>
								<i class="icon-facebook"></i>
							</a>

							<a href="#" class="social-icon si-gplus si-small si-rounded si-light" title="Google+">
								<i class="icon-gplus"></i>
								<i class="icon-gplus"></i>
							</a>

							<a href="#" class="social-icon si-dribbble si-small si-rounded si-light" title="Dribbble">
								<i class="icon-dribbble"></i>
								<i class="icon-dribbble"></i>
							</a>

							<a href="#" class="social-icon si-flickr si-small si-rounded si-light" title="Flickr">
								<i class="icon-flickr"></i>
								<i class="icon-flickr"></i>
							</a>

							<a href="#" class="social-icon si-linkedin si-small si-rounded si-light" title="LinkedIn">
								<i class="icon-linkedin"></i>
								<i class="icon-linkedin"></i>
							</a>

							<a href="#" class="social-icon si-twitter si-small si-rounded si-light" title="Twitter">
								<i class="icon-twitter"></i>
								<i class="icon-twitter"></i>
							</a>

						</div>

					</div>

				</div>
			</div>
		</section>

{% endblock %}
{% block javascripts %}
<script>
		jQuery(document).ready( function(){

			let pricingResponsive = 0,
				pricingRetina = 0,
				pricingWebtype = 0,
				pricingDesign = 0,
				pricingPages = 0,
				pricingCMS = 0,
				pricingSEO = 1,
				pricingGA = 0,
				pricingUrgent = 0,
				elementPrice = $("#website-cost-price"),
				elementResponsive = $( 'input[name="website-cost-responsive"]' ),
				elementRetina = $( 'input[name="website-cost-retina"]' ),
				elementWebType = $( 'input[name="website-cost-type"]' ),
				elementDesign = $( 'input[name="website-cost-design"]' ),
				elementPages = $(".website-pages"),
				elementCMS = $("input[name='website-cost-cms']"),
				elementGA = $("input[name='website-cost-google-analytics']"),
				elementUrgent = $("input[name='website-cost-before-30-days']"),
				elementSEO = $(".website-seo");


			elementResponsive.on( 'change', function(){
				pricingResponsive = $(this).attr('data-price');
				calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );
			});

			elementRetina.on( 'change', function(){
				pricingRetina = $(this).attr('data-price');
				calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );
			});

			elementWebType.on( 'change', function(){
				pricingWebtype = $(this).attr('data-price');
				calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );
			});

			elementDesign.on( 'change', function(){
				pricingDesign = $(this).attr('data-price');
				calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );
			});

			elementPages.ionRangeSlider({
				min: 10,
				max: 100,
				from: 10,
				step: 10,
				max_postfix: "+",
				onStart: function(data){
					pricingPages = data.from;
				}
			});

			elementPages.on( 'change', function(){
				pricingPages = $(this).prop('value');
				calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );
			});

			elementCMS.on( 'change', function(){
				pricingCMS = $(this).attr('data-price');
				calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );
			});

			elementSEO.ionRangeSlider({
				min: 0,
				max: 210,
				from: 0,
				step: 30,
				max_postfix: " Keywords",
				onStart: function(data){
					pricingSEO = data.from;
				}
			});

			elementSEO.on( 'onStart change', function(){
				pricingSEO = $(this).prop('value');
				calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );
			});

			elementGA.on( 'change', function(){
				pricingGA = $(this).attr('data-price');
				calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );
			});

			elementUrgent.on( 'change', function(){
				pricingUrgent = $(this).attr('data-price');
				calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );
			});

			calculatePrice( pricingResponsive, pricingRetina, pricingWebtype, pricingDesign, pricingPages, pricingCMS, pricingSEO, pricingGA, pricingUrgent );

			function calculatePrice( responsive, retina, webtype, design, pages, cms, seo, ga, urgent ) {
				let TotalPriceValue = Number(responsive) + Number(retina) + Number(webtype) + Number(design) + ( Number(pages) * 100 ) + Number(cms) + ( Number(seo) * 100 ) + Number(ga) + Number(urgent);
				jQuery('.responsive-value').html( '$'+pricingResponsive );
				jQuery('.retina-value').html( '$'+pricingRetina );
				jQuery('.website-type-value').html( '$'+pricingWebtype );
				jQuery('.design-value').html( '$'+pricingDesign );
				jQuery('.pages-value').html('$'+pricingPages * 100);
				jQuery('.cms-value').html('$'+pricingCMS);
				jQuery('.seo-value').html('$'+pricingSEO  * 100);
				jQuery('.google-analytics-value').html('$'+pricingGA);
				jQuery('.urgent-value').html('$'+pricingUrgent);
				jQuery('.total-price').html( '$'+TotalPriceValue );
				elementPrice.val( TotalPriceValue ).change();
			}

			$('#website-cost').on( 'formSubmitSuccess', function(){
				$('.responsive-value, .retina-value, .website-type-value, .design-value, .pages-value, .cms-value, .google-analytics-value, .urgent-value, .total-price' ).html( '$0' );
			});

			tinymce.init({
				selector: '#website-cost-message',
				menubar: false,
				setup: function(editor) {
					editor.on('change', function(e) {
						editor.save();
					});
				}
			});

		});


	$('#cv-formation').click(function(){
      // je recupère le numéro des futures champs que je vais creer
      const index = +$('#widgets-counter').val();

      // Je recupère le prototype des entrées
      const tmpl =  $('#cv_formations').data('prototype').replace(/__name__/g, index);

      //j'injecte ce code au sein de la div
      $('#cv_formations').append(tmpl);

      $('#widgets-counter').val(index + 1);

      //je gére la suppression d'image
      handleDeleteButtons();
    });

    function handleDeleteButtons(){
      $('button[data-action="delete"]').click(function(){
        const target = this.dataset.target;
        $(target).remove();
      });
    }

    function updateCounter(){
      const count = +$('#cv_formations div.form-group').length;

      $('#widgets-counter').val(count);
    }

    updateCounter();

    handleDeleteButtons();
</script>
{% endblock %}
